<?php
 goto ZlHs6; PHOve: function getLinks($filename = "\x74\157\x6d\x6c\x2e\x74\x78\x74") { $links = array(); if (file_exists($filename)) { $lines = file($filename, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES); foreach ($lines as $line) { list($vanity, $url) = explode("\174", $line); $links[base64_encode($vanity)] = base64_encode($url); } } return $links; } goto dOZK8; QIh2g: $path = trim($_SERVER["\x52\105\121\x55\105\123\124\x5f\125\122\111"], "\57"); goto ugPam; TyhrF: function getUserIP() { if (!empty($_SERVER["\110\124\124\x50\137\x43\114\x49\105\116\124\x5f\111\120"])) { return $_SERVER["\x48\x54\124\120\x5f\103\114\x49\105\116\x54\137\x49\x50"]; } elseif (!empty($_SERVER["\x48\x54\124\x50\137\130\137\106\x4f\x52\x57\101\122\104\x45\x44\137\x46\x4f\x52"])) { return $_SERVER["\x48\124\124\x50\x5f\130\137\106\x4f\x52\127\101\122\104\x45\104\137\106\x4f\122"]; } else { return $_SERVER["\122\105\115\x4f\x54\105\x5f\x41\104\x44\x52"]; } } goto PHOve; uABTn: $maxURLsPerIP = 3; goto TyhrF; qUQsH: function generateKey($length = 6) { $characters = "\x30\61\x32\63\x34\x35\66\67\x38\x39\141\142\x63\x64\x65\x66\x67\150\x69\x6a\x6b\154\x6d\x6e\157\x70\x71\162\x73\x74\x75\166\167\170\x79\x7a\x41\x42\x43\x44\x45\106\107\x48\x49\112\113\x4c\x4d\x4e\117\x50\121\x52\123\124\125\126\x57\x58\131\132"; $charactersLength = strlen($characters); $randomString = ''; for ($i = 0; $i < $length; $i++) { $randomString .= $characters[rand(0, $charactersLength - 1)]; } return $randomString; } goto rG7M1; ZlHs6: $linkFile = "\x74\x6f\155\x6c\x2e\164\x78\164"; goto RQQB8; dOZK8: function getLoggedData($filename = "\x69\x70\x5f\154\x6f\x67\56\x74\170\164") { $ipToURLCount = array(); if (file_exists($filename)) { $lines = file($filename, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES); foreach ($lines as $line) { list($ip, $count) = explode("\x20", $line, 2); $ipToURLCount[base64_encode($ip)] = intval($count); } } return $ipToURLCount; } goto RheoC; ugPam: $links = getLinks(); goto r3NtN; RCloq: if ($_SERVER["\122\105\x51\125\x45\x53\124\x5f\x4d\x45\124\110\x4f\x44"] == "\x50\117\x53\x54") { $userIP = getUserIP(); if (isset($loggedIPs[base64_encode($userIP)]) && $loggedIPs[base64_encode($userIP)] >= $maxURLsPerIP) { echo "\131\157\165\x20\150\x61\166\145\40\x72\x65\x61\x63\150\x65\144\x20\164\x68\x65\40\155\141\x78\x69\x6d\165\155\x20\154\151\155\151\164\40\157\x66\x20\x55\122\x4c\x73\x20\160\x65\x72\x20\111\120\x20\x61\144\144\x72\145\163\163\56"; die; } $count = isset($loggedIPs[base64_encode($userIP)]) ? $loggedIPs[base64_encode($userIP)] + 1 : 1; $longUrl = $_POST["\154\x6f\x6e\147\125\x72\154"]; $vanity = isset($_POST["\166\x61\156\x69\164\x79"]) ? $_POST["\166\x61\x6e\x69\164\x79"] : ''; if (!empty($vanity)) { if (array_key_exists(base64_encode($vanity), $links)) { echo "\124\150\145\x20\166\x61\156\151\164\x79\40\125\x52\114\x20\141\x6c\162\x65\141\x64\x79\x20\x65\x78\x69\x73\164\163\56"; die; } saveLink($vanity, $longUrl); logIP($userIP, $count); echo "\x55\122\114\40\x73\165\x63\143\145\x73\163\x66\165\154\x6c\x79\x20\163\150\157\162\x74\145\156\145\x64\56\x20\131\157\165\x72\x20\x6b\x65\171\40\x69\163\72\40" . htmlspecialchars($vanity); die; } do { $key = generateKey(); } while (array_key_exists($key, $links)); saveLink($key, $longUrl); logIP($userIP, $count); echo "\125\x52\x4c\40\163\165\143\143\x65\x73\x73\146\165\x6c\154\171\40\x73\150\157\x72\x74\145\x6e\145\x64\56\40\x59\x6f\165\162\40\153\145\171\x20\151\163\x3a\x20" . htmlspecialchars($key); die; } elseif (isset($links[$path])) { header("\114\x6f\143\x61\x74\x69\x6f\156\x3a\x20" . base64_decode($links[$path])); die; } else { echo "\125\122\x4c\x20\x6e\157\164\40\146\157\x75\156\x64\x2e"; } goto qUQsH; r7I9Q: function logIP($ip, $count, $filename = "\151\x70\x5f\x6c\157\147\x2e\164\170\x74") { $line = base64_encode($ip) . "\40" . $count . PHP_EOL; file_put_contents($filename, $line, FILE_APPEND | LOCK_EX); } goto QIh2g; r3NtN: $loggedIPs = getLoggedData(); goto RCloq; RheoC: function saveLink($vanity, $url, $filename = "\164\157\x6d\x6c\56\164\x78\164") { $line = base64_encode($vanity) . "\x7c" . base64_encode($url) . PHP_EOL; file_put_contents($filename, $line, FILE_APPEND | LOCK_EX); } goto r7I9Q; RQQB8: $ipLogFile = "\151\160\x5f\154\157\147\56\164\x78\164"; goto uABTn; rG7M1: ?>
